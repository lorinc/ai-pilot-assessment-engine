============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- /home/lorinc/CascadeProjects/ai-pilot-assessment-engine/venv/bin/python
cachedir: .pytest_cache
rootdir: /home/lorinc/CascadeProjects/ai-pilot-assessment-engine
configfile: pytest.ini
plugins: asyncio-1.2.0, langsmith-0.4.41, anyio-4.11.0, mock-3.15.1, cov-7.0.0
asyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 12 items

tests/patterns/test_pattern_engine_r22.py::TestPatternEngineWithSituationalAwareness::test_pattern_engine_has_situational_awareness PASSED [  8%]
tests/patterns/test_pattern_engine_r22.py::TestPatternEngineWithSituationalAwareness::test_situation_updates_from_triggers PASSED [ 16%]
tests/patterns/test_pattern_engine_r22.py::TestPatternEngineWithSituationalAwareness::test_situation_evolves_across_turns PASSED [ 25%]
tests/patterns/test_pattern_engine_r22.py::TestPatternEngineWithResponseComposer::test_pattern_engine_has_response_composer PASSED [ 33%]
tests/patterns/test_pattern_engine_r22.py::TestPatternEngineWithResponseComposer::test_response_composition_used PASSED [ 41%]
tests/patterns/test_pattern_engine_r22.py::TestPatternEngineWithResponseComposer::test_reactive_and_proactive_patterns PASSED [ 50%]
tests/patterns/test_pattern_engine_r22.py::TestIntegratedFlow::test_complete_conversation_flow PASSED [ 58%]
tests/patterns/test_pattern_engine_r22.py::TestIntegratedFlow::test_situation_drives_context_loading PASSED [ 66%]
tests/patterns/test_pattern_engine_r22.py::TestTokenBudgetWithComposition::test_token_budget_maintained PASSED [ 75%]
tests/patterns/test_pattern_engine_r22.py::TestBackwardCompatibility::test_existing_process_message_still_works PASSED [ 83%]
tests/patterns/test_pattern_engine_r22.py::TestBackwardCompatibility::test_knowledge_tracker_still_updated PASSED [ 91%]
tests/patterns/test_pattern_engine_r22.py::TestBackwardCompatibility::test_trigger_detection_still_works PASSED [100%]
ERROR: Coverage failure: total of 16 is less than fail-under=80


================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                            Stmts   Miss  Cover   Missing
-----------------------------------------------------------------------------
src/__init__.py                                     0      0   100%
src/app.py                                        161    161     0%   3-303
src/config/__init__.py                              0      0   100%
src/config/settings.py                             24     24     0%   3-54
src/core/__init__.py                                0      0   100%
src/core/firebase_client.py                       233    233     0%   3-568
src/core/graph_manager.py                         241    241     0%   3-624
src/core/llm_client.py                             90     90     0%   3-300
src/core/session_manager.py                        82     82     0%   3-197
src/engines/__init__.py                             0      0   100%
src/engines/assessment.py                         103    103     0%   3-431
src/engines/bottleneck.py                         113    113     0%   3-362
src/engines/discovery.py                          175    175     0%   3-405
src/orchestrator/__init__.py                        0      0   100%
src/orchestrator/conversation_orchestrator.py     126    126     0%   3-408
src/patterns/__init__.py                            0      0   100%
src/patterns/knowledge_tracker.py                  68     40    41%   144, 153, 171, 184-209, 218, 232, 250-261, 273-288, 300-302
src/patterns/models.py                             89     41    54%   40-51, 56, 85-94, 99, 122, 130, 169-200, 204, 217
src/patterns/pattern_engine.py                    116     68    41%   56-59, 90, 105-116, 127-160, 176-201, 210, 229-262, 274-275, 290-291, 305-317, 322-328, 332, 336-343, 351, 375
src/patterns/pattern_loader.py                    108     89    18%   43-70, 74, 92-118, 123-130, 148-166, 178-179, 191-192, 196-198, 207-246
src/patterns/pattern_selector.py                  123     97    21%   66-71, 81-82, 104-123, 136-175, 188-208, 220-239, 247-250, 265-290, 307-327, 339-342, 350
src/patterns/response_composer.py                  55     33    40%   83-96, 117-164, 191-229
src/patterns/situational_awareness.py              49     15    69%   80, 122-133, 145-150, 154-155, 171-173
src/patterns/trigger_detector.py                  160     49    69%   203, 213, 247, 259-261, 271, 292, 301, 310, 336, 357, 369-371, 382, 404, 440, 453, 463, 475, 488, 501-507, 520-542, 553-555, 566, 578
src/utils/__init__.py                               0      0   100%
src/utils/logger.py                                39     39     0%   3-113
-----------------------------------------------------------------------------
TOTAL                                            2155   1819    16%
Coverage HTML written to dir htmlcov
FAIL Required test coverage of 80% not reached. Total coverage: 15.59%
============================== 12 passed in 0.38s ==============================
